<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://projetointegradoradsfatec.github.io/pi-docs/python-cnn/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Sistema Inteligente - User Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">User Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">API-Restful <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../api-restful/" class="dropdown-item">About</a>
</li>
                                    
<li>
    <a href="../api-restful/geoserver/" class="dropdown-item">Geoserver</a>
</li>
                                    
<li>
    <a href="../api-restful/db/" class="dropdown-item">Data Base</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../web-gis/" class="nav-link">Web-GIS</a>
                            </li>
                            <li class="navitem active">
                                <a href="./" class="nav-link">Sistema Inteligente</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../web-gis/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/ProjetoIntegradorADSFatec/pi-docs/edit/master/docs/python-cnn/index.md" class="nav-link">Edit on docs-pi</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#python-convolutional-neural-networks" class="nav-link">Python Convolutional Neural Networks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="python-convolutional-neural-networks">Python Convolutional Neural Networks<a class="headerlink" href="#python-convolutional-neural-networks" title="Permanent link">&para;</a></h1>
<p><a href="https://docs.conda.io/en/latest/miniconda.html"><img alt="Miniconda" src="https://img.shields.io/badge/miniconda-3-green" /></a>
<a href="https://www.python.org/"><img alt="Python" src="https://img.shields.io/badge/python-3.8-green" /></a>
<a href="https://www.tensorflow.org/"><img alt="Tensorflow" src="https://img.shields.io/badge/tensorflow-2.1-green" /></a>
<a href="https://jupyter.org/"><img alt="JupyterLab" src="https://img.shields.io/badge/jupyter-1.0-green" /></a></p>
<p>O sistema deve reconhecer áreas de talhões (unidade mínima de cultivo de uma propriedade) em um mapa, utilizando dados multitemporais (<a href="https://www.tensorflow.org/tutorials/images/classification">TensorFlow  Classificador de imagens</a>), através de inteligência artificial, a interface gráfica (Web GIS), deve permitir ao usuário selecionar um intervalo de tempo e as imagens de um catálogo disponível para a região selecionada, carregando-as em bloco para não sobrecarregar o sistema e ter opção para download.</p>
<p>Web GIS (Web Geographic Information System): Portal de um “Sistema de Informação Geográfica” (SIG), baseado em padrão de serviços web OGC, fornecendo uma estrutura para visualização e navegação de mapas (basemaps) e de dados geográficos vetoriais e matriciais.</p>
<ul>
<li>
<p>Catálogo de Imagem: O Catálogo de Imagem deve possibilitar a catalogação de coleções de dados espaço-temporal, (metadados) dos satélites Landsat 8 e Sentinel-2. Obs: O catálogo de imagem também deverá fornecer interface (web API) que permitirá consultar e recuperar as cenas de satélite catalogadas. Esta interface possibilitará que o Web GIS realize pesquisas complexas, filtrando diferentes parâmetros e especificando critérios geográficos.</p>
</li>
<li>
<p>Map Tile Engine: Esse componente deve produzir “map raster tile” para uma determinada cena de satélite, obedecendo ao padrão OGC WMTS. Permitindo que
usuários do Web GIS visualizem e naveguem pelas imagens sem precisar baixá-las (real time streaming). Cada map tile é uma representação visual de parte da imagem, não dos dados em si. Esses tiles geralmente são renderizados em formato pictórico (PNG ou JPEG) que podem ser exibidos em uma aplicação web.</p>
</li>
<li>
<p>Download: Após a consulta às imagens de uma determinada área de interesse, o sistema permite o download de todas as cenas (com todas as suas bandas) do período selecionado pelo usuário (Pilha de imagem).</p>
</li>
<li>
<p>Máscara (Mask): Neste módulo, o sistema gerará uma máscara binária com as regiões de interesse (AOI’s) para cada cena selecionada. A construção das máscaras de saída das áreas de interesse, se dão apresentando valor igual a um (1) dentro desse poligono, enquanto as demais áreas (áreas não selecionadas) apresentam valor igual a zero (0).</p>
</li>
</ul>
<p align = "center">
  <img width = "600px" src = "../assets/example.png">
</p>

<ul>
<li>Arquivo: Após a geração da máscara para cada cena (scene), é preciso armazená-la tanto para validação visual quanto para download. Com isso, nesse módulo a máscara deve ser armazenada de alguma forma que possibilite ao usuário fazer sua validação visual (próxima etapa), assim como o download para treinamento de modelos de inteligência artificial.</li>
</ul>
<blockquote>
<p>Funcionamento das redes neurais convolucionais para o processamento das imagens.</p>
</blockquote>
<p><strong>Obs.:</strong> Instalação do Miniconda é necessária para a execução dos comandos a seguir.</p>
<h3 id="ambiente-de-desenvolvimento">Ambiente de Desenvolvimento<a class="headerlink" href="#ambiente-de-desenvolvimento" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code># Crie um novo ambiente conda com Python3+
$ conda create --name python-cnn python=3.6.9

# Ativar o ambiente
$ conda activate python-cnn

# Com o ambiente ativado instalar o ipykernel
(python-cnn) $ conda install notebook ipykernel

# Com o ipykernel criar um kernel com o python 3.5 automático
(python-cnn) $ ipython kernel install --user --name python-cnn

# Instalar o servidor Jupyter Lab
(python-cnn) $ python -m pip install jupyter

# Instalar a biblioteca gdal e basemap para processar as imagens
(python-cnn) $ conda install -c conda-forge gdal=2.4.4

# Executar o servidor em modo de desenvolvimento
(python-cnn) $ jupyter notebook
</code></pre></div>


<blockquote>
<p><strong>Obs.:</strong> Pode ser que o Notebook não  reconheça o kernel instalado pelo conda, sendo assim você pode alterar manualmente <code>kernel &gt;&gt; Change Kernel &gt;&gt; python-cnn</code>.</p>
</blockquote>
<h3 id="ambiente-de-micro-servicos-em-docker">Ambiente de micro serviços em docker<a class="headerlink" href="#ambiente-de-micro-servicos-em-docker" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>    TODO
</code></pre></div>


<h3 id="codigo-fonte">Código fonte<a class="headerlink" href="#codigo-fonte" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Também será necessário acesso ao <a href="http://www.dpi.inpe.br/agricultural-database/lem/dados/cenas/Sentinel1/">servidor FTP</a>.</p>
<p>Para a execução do código fonte abaixo é necessário o download da pasta <a href="https://fatecspgov-my.sharepoint.com/:f:/g/personal/abner_anjos_fatec_sp_gov_br/EqcawzIRy5VBhi7LqlXGtpgB-DHpZq5IG1DspKuwD59YBA?e=4LEDNC"><code>data/</code></a>, após o download descompacte na pasta root do projeto.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code>data/
    |_ input/
        |_ train/
        |_ validation/
    |_ output/
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="c1"># !pip install tensorflow matplotlib pillow wget</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Conv2D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">MaxPooling2D</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.preprocessing.image</span> <span class="kn">import</span> <span class="n">ImageDataGenerator</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">services.georasters</span> <span class="kn">import</span> <span class="n">Georaster</span> <span class="k">as</span> <span class="n">gr</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="c1"># clip_20170612T083546_Sigma0_VH_db</span>
<span class="c1"># getGeoRaster(self, date, band, file=False, download=True, convert=True):</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">gr</span><span class="p">(</span><span class="s1">&#39;/home/abner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">getGeoRaster</span><span class="p">(</span><span class="s1">&#39;2017-06-12 08h:35m:46s&#39;</span><span class="p">,</span><span class="s1">&#39;vh&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">convert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image/jpg&quot;</span><span class="p">)</span>
</code></pre></div>


<p align = "center">
  <img width = "600px" src = "../assets/output_5_0.png">
</p>

<div class="codehilite"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;georaster&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>&#39;PROJCS[&quot;WGS 84 / UTM zone 23S&quot;,GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0,AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],UNIT[&quot;degree&quot;,0.0174532925199433,AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]],PROJECTION[&quot;Transverse_Mercator&quot;],PARAMETER[&quot;latitude_of_origin&quot;,0],PARAMETER[&quot;central_meridian&quot;,-45],PARAMETER[&quot;scale_factor&quot;,0.9996],PARAMETER[&quot;false_easting&quot;,500000],PARAMETER[&quot;false_northing&quot;,10000000],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],AXIS[&quot;Easting&quot;,EAST],AXIS[&quot;Northing&quot;,NORTH],AUTHORITY[&quot;EPSG&quot;,&quot;32723&quot;]]&#39;
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;georaster&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">()</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>{&#39;AREA_OR_POINT&#39;: &#39;Area&#39;}
</code></pre></div>


<div class="codehilite"><pre><span></span><code><span class="n">band</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;georaster&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">band</span>
</code></pre></div>


<div class="codehilite"><pre><span></span><code>&lt;osgeo.gdal.Band; proxy of &lt;Swig Object of type &#39;GDALRasterBandShadow *&#39; at 0x7f120b5ad540&gt; &gt;
</code></pre></div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2020 Fatec SP.</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
